<div class="accordion" id="accordionMaterias">

  @for (item of materiasConResumen; track $index) {
    <div class="accordion-item">

      <h2 class="accordion-header" [id]="'heading-' + $index">
        <button
          class="accordion-button collapsed fw-bold d-flex align-items-center"
          type="button"
          data-bs-toggle="collapse"
          [attr.data-bs-target]="'#collapse-' + $index"
        >

          <!-- Nombre de la materia -->
          <span class="flex-grow-1">
            {{ item.materia.matNombre }}
          </span>

          @if (item.resumen) {

            <!-- Contenedor visual -->
            <div class="d-flex align-items-center gap-2 ms-3">

              <!-- Barra -->
              <div
                class="progress"
                style="width: 100px; height: 6px;"
              >
                <div
                  class="progress-bar"
                  role="progressbar"
                  [class]="getClaseBarra(item.resumen)"
                  [style.width.%]="getPorcentajeAsistencia(item.resumen)"
                >
                </div>
              </div>

              <!-- Asistencias / Total -->
              <small
                class="text-muted fw-semibold text-nowrap"
                style="font-size: 0.75rem;"
              >
                {{ getAsistencias(item.resumen) }}
                /
                {{ getAsistenciasTotales(item.resumen) }}
              </small>

            </div>

          }

        </button>
      </h2>

      <div
        class="accordion-collapse collapse"
        [id]="'collapse-' + $index"
        data-bs-parent="#accordionMaterias"
      >
        <div class="accordion-body">

          @if (item.loading) {
            <div class="alert alert-info">
              Cargando resumen...
            </div>
          }

          @if (item.error) {
            <div class="alert alert-danger">
              {{ item.error }}
            </div>
          }

          @if (item.resumen && !item.loading) {

            <div class="d-flex justify-content-around p-2 bg-light rounded">
              <span class="text-success fw-bold">
                Presente: {{ item.resumen.resumen_asistencias.presente }}
              </span>

              <span class="text-warning fw-bold">
                Tarde: {{ item.resumen.resumen_asistencias.tardanzas }}
              </span>

              <span class="text-danger fw-bold">
                Ausente: {{ item.resumen.resumen_asistencias.faltas }}
              </span>
            </div>

          }

        </div>
      </div>

    </div>
  } @empty {
    <div class="p-3">No hay materias para mostrar.</div>
  }

</div>
